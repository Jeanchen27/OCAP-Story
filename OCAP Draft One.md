# 开放链访问协议Beta版6月亮相

ArcBlock区块基石，是目前全球区块链领域中少有的，既非公链、又非去中心化应用（DApps），而是专门为DApps开发和部署提供服务的云计算平台。在这样一个旨在帮助开发者更容易地开发区块链应用的云服务平台，开放链访问协议（Open Chain Access Protocol）处于极为关键的地位。

开放链访问协议（简称OCAP）是一个开源协议，用于提供一个访问下层区块链的抽象接口层。据今年1月初发布的ArcBlock技术白皮书描述，“类似于在数据应用中的ODBC或JDBC在和各种不同数据库之间的关系一样，我们的开放链访问协议让你的应用可以在不同的区块链上工作。在切换不同的底层区块链、或者使用多条不同协议的区块链的时候，你甚至不需要更改你的业务逻辑代码。”

OCAP主要解决的是平台锁定和用户选择的问题。任何一个希望开发DApps的开发者，都会遇到这样一个令人纠结的技术选择问题：该选择什么底层区块链？如果选择了之后将来不合适怎么办……而有了OCAP这么一个抽象接口层，开发者在写应用代码的时候，就不需要关心具体某个链的细节，而是在这个抽象层上来写区块链的应用。这样，可以让大家省出宝贵的精力专注于自己的业务和应用设计，连接底层区块链技术的脏活累活，全都交给ArcBlock平台即可。

今年6月，经ArcBlock工程团队几个月来日以继夜的不懈努力，OCAP将首度发布，与社区开发者见面。ArcBlock第一个亮相的技术产品将是什么样子？能提供哪些功能？是用什么技术开发实现的？面临哪些技术难题和挑战？OCAP开发负责人Peiling接受了独家专访。

据Peiling确认，6月亮相的OCAP还不是RC1（正式发行候选）版，而是面向开发者、邀请公开测试的试用版。在这个版本，ArcBlock希望让开发者首先对OCAP是个什么有个基本认知和体验，因此实现了一些基本的API，让开发者可以先轻松灵活的进行“读”操作，查询链上如账户、地址、交易等区块里的数据。Peiling说，“一个最简单的例子，就是用户可以轻松的查询过去一段时间内我都给谁转过币，或者谁给我转过币，并且还可以很轻松的针对一些指标来对查询数据进行过滤，比如转账金额。”

OCAP的开发实现，ArcBlock率先采用GraphQL，这一Facebook2015年开始采用、2015年开源的API查询语言，而非业内普遍采用的REST API。Peiling表示，这是ArcBlock考虑开发者体验是否良好而做出的选择，采用GraphQL作为查询语言，将使得前端查询更加灵活且高效。

“因为通常最普通、也是采用最多的方式就是提供一组REST API。在服务器端，我们会设置众多endpoint（终端），每个endpoint会接受一些参数，并提供一些服务。这样做的好处很明显，就是对服务器端来说实现也很简单，而且普通用户可以很轻易的通过浏览器访问。最典型的应用就是BlockCypher、EtherScan。”眼下，确实有不少刚刚下载钱包、接触加密数字货币的用户点击地址等一串字符、通过BlockCypher、EtherScan浏览器查询交易往来查的不亦乐乎。

不过，Peiling指出，“但是缺点也很明显，那就是对开发者不够友好。REST API是基于endpoint来发起查询，其组织形式非常松散，开发者使用起来并不友好。特别是当开发者需要开发一些APP的时候，这种松散的endpoint常常会让客户端的代码维护变得非常麻烦，所以从开发者的角度出发，我们选择GraphQL；第二，GraphQL的查询非常灵活。它允许前端自定义想要返回的数据，而且也让前端的级联查询变的非常简单。总之，从开发者的用户体验上来说，GraphQL比普遍流行的REST API要好上许多。”据了解，GraphQL不仅在OCAP链上部分采用，也将应用在ArcBlock平台的链下部分，目的就是为开发者提供无缝流畅的体验。

据Peiling介绍，目前第一版OCAP能查询支持的链上数据是比特币（Bitcoin）和以太坊（Ethereum）这两条用户最多、最成熟的基础公链。这两者的链的组织结构大致相同，数据结构也有很多相同的地方，共识算法都是工作量证明（PoW）。两者不同点在于，比特币是基于UTXO系统，而以太坊是基于Account Balance的系统，并且以太坊还有智能合约这一极大增加复杂度的事物。
 
OCAP既要统一处理两者的相同点，又得区别对待它们的不同点——技术上的难度就是在于如何处理两者的不同之处。Peiling说，“我们的初衷是为开发者打造优秀流畅的体验，避免访问不同区块链产生截然不同、十分割裂的体验，尽量将两条链揉合在一起，但是过于揉合，又会让底层实现显得不自然，所以需要时刻平衡这两点。”

OCAP进展到现在，碰上的最大挑战和难题就是对链上数据的处理：在相当短的时间内对比特币自2009年、以太坊自2015年创世以来产生的所有区块链数据，类似于Google索引全球网页数据那样进行索引处理，比特币和以太坊的链上数据是以紧凑的方式存储，ArcBlock需要展开丰富，以便OCAP连接访问。Peiling透露，“我们之前是想采用传统数据库的方式来处理并存储这些数据，但是我们发现数据库的性能很难达到我们的要求。所以我们采用了另外一种途径，ETL,也就是data pipeline的方式来处理。以后会遇到的挑战肯定会有很多，比如性能调优，安全，链上链下数据的有机结合都会是我们的挑战。”

在Peiling的脑海中，未来的DApps可以很轻松的通过GraphQL来访问OCAP。比如，开发者可以很轻松进行级联查询、订阅推送通知，或者是提交对链上数据的修改。不过，第一版OCAP还未支持数据提交修改的能力，只是让大家体验OCAP是什么，欢迎大家来抓虫。而且还同时为开发者提供web版控制台（playground），可以让大家无需下载即可迅速上手使用。之后，ArcBlock将会把“playground”延展为“playbook”，一个允许开发者分享代码片段和提示的互动文档和社区，然后playbook将演进为应用托管环境，开发者可真正用于完整的应用开发。
